<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>モツオポーカー</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #f0f4f8; /* 背景色変更 */
    }
    h1 {
      font-size: 2em;
      margin: 20px 0;
    }
    #cards button {
      font-size: 24px;
      margin: 5px;
      width: 60px;
      height: 60px;
      border-radius: 8px;
    }
    #cards button.selected {
      background-color: #87cefa;
    }
    .word-list span {
      display: inline-block;
      margin: 4px;
      padding: 4px 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: white;
    }
    button {
      font-size: 16px;
      margin: 8px;
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
    }
    .status {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>モツオポーカー</h1>
  <div>スコア: <span id="score">0</span></div>
  <div>残りカード: <span id="deckCount">65</span></div>
  <div>ヒント残り: <span id="hintCount">5</span></div>
  <div id="cards"></div>
  <button onclick="confirmSelection()">決定</button>
  <button onclick="showHint()">ヒント</button>
  <div class="status" id="resultText"></div>
  <h3>成立する単語一覧</h3>
  <div class="word-list" id="validWords"></div>

  <script>
    const allWords = [
      "シロ", "シロシオ", "シロタレ", "シロミソ", "シロスヤキ", "シロナマ",
      "レバ", "レバシオ", "レバタレ", "レバミソ", "レバスヤキ", "レバボイル",
      "ガツ", "ガツシオ", "ガツタレ", "ガツミソ", "ガツスヤキ", "ガツナマ",
      "ナンコツ", "ナンコツシオ", "ナンコツタレ", "ナンコツミソ", "ナンコツスヤキ",
      "アブラ", "アブラシオ", "アブラタレ",
      "ハツ", "ハツシオ", "ハツミソ", "ハツスヤキ",
      "カシラ", "カシラシオ", "カシラタレ", "カシラミソ",
      "ビール", "ウメワリ", "ブドウワリ", "ウィスキー", "サイダー",
      "ツル", "ツルシオ", "ツルスヤキ", "キツルミソ",
      "ソンタレ", "シンキタン", "ナマオシンコ", "ダイコン", "ニコミホネツインズ"
    ];

    let deck = [];
    let currentCards = [];
    let selected = [];
    let score = 0;
    let hints = 5;

    const kanaList = ["シ", "ロ", "タ", "レ", "ミ", "ソ", "ス", "ヤ", "キ", "ナ", "マ", "ガ", "ツ", "レ", "バ", "ハ", "ツ", "カ", "シ", "ラ", "ビ", "ー", "ル", "ウ", "メ", "ワ", "リ", "ド", "ブ", "ウ", "ィ", "ス", "キ", "ー", "サ", "イ", "ダ", "ー", "ツ", "ル", "オ", "ン", "コ", "ダ", "イ", "ネ"];

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function initGame() {
      for (let i = 0; i < 4; i++) kanaList.push(...kanaList);
      deck = [...kanaList];
      shuffle(deck);
      drawCards();
      displayValidWords();
    }

    function drawCards() {
      currentCards = deck.splice(0, 10);
      selected = [];
      updateDisplay();
    }

    function updateDisplay() {
      document.getElementById("cards").innerHTML = "";
      currentCards.forEach((kana, i) => {
        const btn = document.createElement("button");
        btn.textContent = kana;
        if (selected.includes(i)) btn.classList.add("selected");
        btn.onclick = () => toggleSelect(i);
        document.getElementById("cards").appendChild(btn);
      });
      document.getElementById("deckCount").textContent = deck.length;
      document.getElementById("score").textContent = score;
      document.getElementById("hintCount").textContent = hints;
    }

    function toggleSelect(index) {
      if (selected.includes(index)) {
        selected = selected.filter(i => i !== index);
      } else {
        selected.push(index);
      }
      updateDisplay();
    }

    function confirmSelection() {
      if (selected.length === 0) {
        drawCards();
        document.getElementById("resultText").textContent = "選択なし。カードを引き直しました。";
        return;
      }
      const word = selected.map(i => currentCards[i]).join("");
      if (allWords.includes(word)) {
        score += selected.length;
        document.getElementById("resultText").textContent = `成立: ${word} +${selected.length}点`;
        drawCards();
      } else {
        document.getElementById("resultText").textContent = "不成立。カードを引き直します。";
        drawCards();
      }
    }

    function showHint() {
      if (hints <= 0) return;
      const combos = getAllCombinations(currentCards);
      for (const combo of combos) {
        if (allWords.includes(combo)) {
          selected = [];
          for (let i = 0; i < combo.length; i++) {
            const idx = currentCards.indexOf(combo[i], selected[selected.length - 1] + 1 || 0);
            if (idx !== -1) selected.push(idx);
          }
          updateDisplay();
          hints--;
          document.getElementById("hintCount").textContent = hints;
          return;
        }
      }
      document.getElementById("resultText").textContent = "ヒントなし";
    }

    function getAllCombinations(arr) {
      const results = [];
      for (let len = 2; len <= arr.length; len++) {
        const combine = (prefix, rest) => {
          if (prefix.length === len) {
            results.push(prefix.join(""));
            return;
          }
          for (let i = 0; i < rest.length; i++) {
            combine([...prefix, rest[i]], rest.slice(i + 1));
          }
        };
        combine([], arr);
      }
      return results;
    }

    function displayValidWords() {
      const container = document.getElementById("validWords");
      container.innerHTML = "";
      allWords.forEach(word => {
        const span = document.createElement("span");
        span.textContent = word;
        container.appendChild(span);
      });
    }

    initGame();
  </script>
</body>
</html>
