<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>モツオポーカー</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #fefceb;
    }
    h1 {
      font-size: 2.5em;
      margin: 20px 0;
    }
    #cards button {
      font-size: 32px;
      margin: 6px;
      width: 64px;
      height: 64px;
      border-radius: 8px;
    }
    #cards button.selected {
      background-color: #87cefa;
    }
    .word-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 10px auto;
      max-width: 90%;
    }
    .word-list span {
      font-size: 20px;
      margin: 4px;
      padding: 4px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: white;
    }
    button {
      font-size: 20px;
      margin: 10px;
      padding: 10px 16px;
      border-radius: 6px;
      border: none;
    }
    .status {
      margin-top: 15px;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>モツオポーカー</h1>
  <div>スコア: <span id="score">0</span></div>
  <div>残りカード: <span id="deckCount">108</span></div>
  <div>ヒント残り: <span id="hintCount">5</span></div>
  <div id="cards"></div>
  <button onclick="confirmSelection()">決定</button>
  <button onclick="showHint()">ヒント</button>
  <div class="status" id="resultText"></div>
  <h3>成立する単語一覧</h3>
  <div class="word-list" id="validWords"></div>

  <script>
    const allWords = [
      "シロ","シロシオ","シロタレ","シロミソ","シロスヤキ","シロナマ",
      "レバ","レバシオ","レバタレ","レバミソ","レバスヤキ","レバボイル",
      "ガツ","ガツシオ","ガツタレ","ガツミソ","ガツスヤキ","ガツナマ",
      "ナンコツ","ナンコツシオ","ナンコツタレ","ナンコツミソ","ナンコツスヤキ","ナンコツナマ",
      "アブラ","アブラシオ","アブラタレ","アブラスヤキ","アブラミソ","アブラナマ",
      "ハツ","ハツシオ","ハツミソ","ハツスヤキ","ハツナマ",
      "カシラ","カシラシオ","カシラミソ","カシラタレ","カシラスヤキ",
      "ビール","ウメワリ","ブドウワリ","ウイスキー","サイダー",
      "ツル","ツルシオ","ツルスヤキ","ツルミソ","ツルタレ",
      "シンキ","タンナマ","オシンコ","ダイコン","ホネ","ツインズ"
    ];

    let kanaList = [];
    const kanaBase = [
  "シ","ロ","シ","ロ","シ","オ","タ","レ","ミ","ソ","ス","ヤ","キ","ナ","マ",
  "ガ","ツ","ガ","ツ","ガ","ツ","レ","バ","レ","バ","バ","ボ","イ","ル",
  "ハ","ツ","ハ","ツ","ハ","ツ","カ","シ","ラ","カ","シ","ラ","ビ","ー","ル",
  "ウ","メ","ワ","リ","ブ","ド","ウ","イ","ス","キ","ー","サ","イ","ダ","ー",
  "ツ","ル","ツ","ル","ホ","ネ","ン","コ","オ","シ","ン","コ","ダ","イ","コ",
  "ン","ツ","イ","ン","ズ","シ","ン","レ","バ","ツ","ル"
];

    let deck = [];
    let currentCards = [];
    let selected = [];
    let score = 0;
    let hints = 5;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function initGame() {
      kanaList = [];
      for (let i = 0; i < 4; i++) kanaList.push(...kanaBase);
      shuffle(kanaList);
      deck = kanaList.slice(0, 120);
      currentCards = deck.splice(0, 12);
      updateDisplay();
      displayValidWords();
    }

    function updateDisplay() {
      document.getElementById("cards").innerHTML = "";
      currentCards.forEach((kana, i) => {
        const btn = document.createElement("button");
        btn.textContent = kana;
        if (selected.includes(i)) btn.classList.add("selected");
        btn.onclick = () => toggleSelect(i);
        document.getElementById("cards").appendChild(btn);
      });
      document.getElementById("deckCount").textContent = deck.length;
      document.getElementById("score").textContent = score;
      document.getElementById("hintCount").textContent = hints;
    }

    function toggleSelect(index) {
      if (selected.includes(index)) {
        selected = selected.filter(i => i !== index);
      } else {
        selected.push(index);
      }
      updateDisplay();
    }

    function confirmSelection() {
      if (selected.length === 0) {
        currentCards = deck.splice(0, 12);
        selected = [];
        document.getElementById("resultText").textContent = "選択なし。カードを引き直しました。";
        updateDisplay();
        return;
      }

      const selectedChars = selected.map(i => currentCards[i]);
      const sortedSelected = selectedChars.slice().sort().join("");

      const matchingWords = allWords.filter(word =>
        word.length === selectedChars.length &&
        word.split("").sort().join("") === sortedSelected
      );

      if (matchingWords.length > 0) {
        score += selected.length;
        document.getElementById("resultText").textContent = `成立: ${matchingWords[0]} +${selected.length}点`;
      } else {
        document.getElementById("resultText").textContent = "不成立。カードを引き直します。";
      }

      selected.forEach(i => {
        currentCards[i] = deck.length > 0 ? deck.shift() : "";
      });

      selected = [];
      updateDisplay();
    }

    function showHint() {
      if (hints <= 0) {
        document.getElementById("resultText").textContent = "ヒントなし（残りなし）";
        return;
      }

      const indexes = [...Array(currentCards.length).keys()];
      const getIndexCombos = (prefix, rest) => {
        const result = [];
        for (let i = 0; i < rest.length; i++) {
          const next = [...prefix, rest[i]];
          result.push(next);
          result.push(...getIndexCombos(next, rest.slice(i + 1)));
        }
        return result;
      };

      const combos = getIndexCombos([], indexes);

      for (const combo of combos) {
        const chars = combo.map(i => currentCards[i]);
        const sortedCombo = chars.slice().sort().join("");
        const match = allWords.find(word =>
          word.length === chars.length &&
          word.split("").sort().join("") === sortedCombo
        );

        if (match) {
          selected = combo;
          hints--;
          updateDisplay();
          document.getElementById("hintCount").textContent = hints;
          document.getElementById("resultText").textContent = `ヒント: ${match}`;
          return;
        }
      }

      document.getElementById("resultText").textContent = "ヒントなし";
    }

    function displayValidWords() {
      const container = document.getElementById("validWords");
      container.innerHTML = "";
      allWords.forEach(word => {
        const span = document.createElement("span");
        span.textContent = word;
        container.appendChild(span);
      });
    }

    initGame();
  </script>
</body>
</html>
