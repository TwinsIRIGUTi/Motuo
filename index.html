<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>モツオポーカー</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    #hand {
      margin: 20px auto;
      display: grid;
      grid-template-columns: repeat(6, 60px);
      grid-auto-rows: 60px;
      gap: 10px;
      justify-content: center;
      max-width: 420px;
    }
    #word-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 600px;
      margin: 0 auto;
      font-size: 14px;
    }
    .card {
      border: 1px solid #333;
      border-radius: 6px;
      padding: 10px 0;
      font-size: 20px;
      cursor: pointer;
      user-select: none;
      width: 60px;
      height: 60px;
      line-height: 40px;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      color: black;
      transition: color 0.3s ease;
    }
    .selected { background-color: lightblue; }
    .hinted { color: red !important; }
    button { margin: 10px 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
    #status { margin-top: 10px; }
    #top-info {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      font-size: 14px;
    }
    #final-score {
      font-size: 36px;
      color: crimson;
      margin-top: 30px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>モツオポーカー</h1>
  <div id="top-info">
    <div id="score">スコア: 0</div>
    <div id="remaining">残りカード: 0</div>
    <div id="hint-count">ヒント残り: 5</div>
  </div>
  <div id="hand"></div>
  <button id="confirm">決定</button>
  <button id="hint">ヒント</button>
  <div id="played"></div>
  <div id="status"></div>
  <div id="final-score"></div>
  <div id="restart-container"></div>
  <h3>成立する単語一覧</h3>
  <div id="word-list"></div>

 <script>
const words = ["motion", "poker", "motsuo", "apple", "code"];
let deck = [];
let currentCard = "";
let selectedLetters = [];
let usedWords = new Set();

const deckElem = document.getElementById("deck");
const currentCardElem = document.getElementById("current-card");
const selectedElem = document.getElementById("selected");
const wordListElem = document.getElementById("word-list");
const confirmBtn = document.getElementById("confirm");
const hintBtn = document.getElementById("hint");
const finalScoreElem = document.getElementById("final-score");
const restartContainer = document.getElementById("restart-container");

function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

function generateDeck() {
  deck = [];
  for (let word of words) {
    for (let char of word) {
      deck.push(char.toUpperCase());
    }
  }
  deck = shuffle(deck);
}

function drawCard() {
  if (deck.length === 0) {
    currentCard = "";
    currentCardElem.textContent = "";
    return;
  }
  currentCard = deck.pop();
  currentCardElem.textContent = currentCard;
}

function updateSelected() {
  selectedElem.textContent = selectedLetters.join("");
}

function checkWord() {
  const word = selectedLetters.join("").toLowerCase();
  if (words.includes(word) && !usedWords.has(word)) {
    usedWords.add(word);
    alert(`正解！: ${word}`);
    selectedLetters = [];
    updateSelected();
    drawCard();
    updateWordList();
    checkGameEnd();
  } else {
    alert("不正解 または 既に使われた単語");
  }
}

function hint() {
  const remaining = words.filter(word => !usedWords.has(word));
  if (remaining.length > 0) {
    alert("ヒント: " + remaining[Math.floor(Math.random() * remaining.length)]);
  } else {
    alert("もうヒントはありません");
  }
}

function updateWordList() {
  wordListElem.innerHTML = "";
  words.forEach(word => {
    const span = document.createElement("span");
    span.textContent = word + " ";
    if (usedWords.has(word)) span.style.textDecoration = "line-through";
    wordListElem.appendChild(span);
  });
}

function checkGameEnd() {
  if (deck.length === 0 && !canFormAnyWord()) {
    finalScoreElem.textContent = `ゲーム終了！スコア: ${usedWords.size}`;
    restartContainer.innerHTML = `<button onclick="restartGame()">リスタート</button>`;
  }
}

function canFormAnyWord() {
  return words.some(word => !usedWords.has(word));
}

function restartGame() {
  usedWords.clear();
  selectedLetters = [];
  updateSelected();
  finalScoreElem.textContent = "";
  restartContainer.innerHTML = "";
  generateDeck();
  drawCard();
  updateWordList();
}

confirmBtn.addEventListener("click", checkWord);
hintBtn.addEventListener("click", hint);

currentCardElem.addEventListener("click", () => {
  if (currentCard) {
    selectedLetters.push(currentCard);
    updateSelected();
    drawCard();
  }
});

generateDeck();
drawCard();
updateWordList();
</script>
</body>
</html>
